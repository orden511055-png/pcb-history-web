<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>My Web Excel</title>

  <!-- Handsontable -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@13.0.0/dist/handsontable.full.min.css">
  <script src="https://cdn.jsdelivr.net/npm/handsontable@13.0.0/dist/handsontable.full.min.js"></script>

  <!-- HyperFormula (å…¬å¼å¼•æ“) -->
  <script src="https://cdn.jsdelivr.net/npm/hyperformula@2.6.0/dist/hyperformula.full.min.js"></script>

  <!-- SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    body { font-family: Arial; padding:20px; }
    #hot { width:100%; height:600px; }
    button { margin-right:10px; }
  </style>
</head>
<body>

<h2>ğŸŒ My Web Excel</h2>

<input type="file" id="upload" />
<button onclick="exportExcel()">åŒ¯å‡º Excel</button>

<br><br>

<div id="hot"></div>

<script>
const container = document.getElementById('hot');

// å»ºç«‹å…¬å¼å¼•æ“
const hyperformulaInstance = HyperFormula.buildEmpty({
  licenseKey: 'gpl-v3'
});

const hot = new Handsontable(container, {
  data: [],
  minRows: 1000,          // åˆå§‹ 1000 è¡Œ
  minCols: 50,            // åˆå§‹ 50 æ¬„
  minSpareRows: 1,        // æ°¸é ä¿ç•™ 1 ç©ºç™½è¡Œï¼ˆè‡ªå‹•å»¶ä¼¸ï¼‰
  minSpareCols: 1,        // æ°¸é ä¿ç•™ 1 ç©ºç™½æ¬„ï¼ˆè‡ªå‹•å»¶ä¼¸ï¼‰
  rowHeaders: true,
  colHeaders: true,
  contextMenu: true,      // å³éµå¯æ’å…¥è¡Œåˆ—
  dropdownMenu: true,
  filters: true,
  columnSorting: true,
  formulas: {
    engine: hyperformulaInstance
  },
  licenseKey: 'non-commercial-and-evaluation'
});

// åŒ¯å…¥ Excel
document.getElementById('upload').addEventListener('change', function(e) {
  const reader = new FileReader();
  reader.onload = function(event) {
    const data = new Uint8Array(event.target.result);
    const workbook = XLSX.read(data, {type: 'array'});
    const sheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[sheetName];
    const json = XLSX.utils.sheet_to_json(worksheet, {header:1});
    hot.loadData(json);

    // ä¿æŒå¯å»¶ä¼¸
    hot.updateSettings({
      minSpareRows: 1,
      minSpareCols: 1
    });
  };
  reader.readAsArrayBuffer(e.target.files[0]);
});

// åŒ¯å‡º Excel
function exportExcel() {
  const data = hot.getData();
  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, "export.xlsx");
}
</script>

</body>
</html>
